From 04dcc50ca65355725426ac717acfee49dcb9904e Mon Sep 17 00:00:00 2001
From: Jan Kiszka <jan.kiszka@siemens.com>
Date: Thu, 25 May 2017 11:09:42 +0200
Subject: [PATCH 04/10] iot2000-hack: Work around DSDT mistake

Until we have a new firmware revision, fix up the incorrect GPIO
interrupt pin in software.

Nothing for upstream.

Signed-off-by: Jan Kiszka <jan.kiszka@siemens.com>
---
 drivers/gpio/gpiolib-acpi.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/drivers/gpio/gpiolib-acpi.c b/drivers/gpio/gpiolib-acpi.c
index 18f5973b9697..457bdd878b9a 100644
--- a/drivers/gpio/gpiolib-acpi.c
+++ b/drivers/gpio/gpiolib-acpi.c
@@ -617,6 +617,13 @@ static int acpi_populate_gpio_lookup(struct acpi_resource *ares, void *data)
 		if (pin_index >= agpio->pin_table_length)
 			return 1;
 
+		if (!strcmp(dmi_get_system_info(DMI_BOARD_NAME),
+			    "SIMATIC IOT2000") &&
+		    !strcmp(agpio->resource_source.string_ptr,
+			    "\\_SB.PCI0.GIP0.GPO") &&
+		    agpio->pin_table[pin_index] == 9)
+			agpio->pin_table[pin_index] = 1;
+
 		lookup->desc = acpi_get_gpiod(agpio->resource_source.string_ptr,
 					      agpio->pin_table[pin_index]);
 		lookup->info.gpioint =
-- 
2.25.1

